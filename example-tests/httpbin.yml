# Tests on httpbin.org
tests:
  - description: 'HTTP GET'
    request:
      scheme: 'http'
      path: '/get'
    response:
      statusCodes: [200]

  - description: 'HTTP GET - wrong status code, assert test failure'
    request:
      scheme: 'http'
      path: '/get'
    response:
      statusCodes: [400]
    shouldFail: true

  - description: 'HTTPS GET'
    request:
      path: '/get'
    response:
      statusCodes: [200]
      headers:
        patterns:
          access-control-allow-origin: '.+'
        notPresent:
          - 'not-present-header'
        notMatching:
          access-control-allow-origin: 'example.com'
      body:
        patterns:
          - 'https://httpbin.org/get'
  
  - description: 'HTTPS GET - notPresent header is present, assert test failure'
    request:
      path: '/get'
    response:
      statusCodes: [200]
      headers:
        patterns:
          access-control-allow-origin: '.+'
        notPresent:
          - 'Host'
        notMatching:
          access-control-allow-origin: 'example.com'
      body:
        patterns:
          - 'https://httpbin.org/get'
    shouldFail: true
  
  - description: 'HTTPS GET - notMatching header is matching, assert test failure'
    request:
      path: '/get'
    response:
      statusCodes: [200]
      headers:
        patterns:
          access-control-allow-origin: '.+'
        notPresent:
          - 'not-present-header'
        notMatching:
          content-type: application/json
      body:
        patterns:
          - 'https://httpbin.org/get'
    shouldFail: true

  - description: 'HTTPS GET - not present subfield'
    request:
      path: '/get'
    response:
      statusCodes: [200]
      headers:
        patterns:
          access-control-allow-origin: '.+'
        notPresent:
          - 'not-present-header'
        notMatching:
          access-control-allow-origin: 'example.com'
        notPresentSubfields:
          Content-Type: ^notreal/fake$
      body:
        patterns:
          - 'https://httpbin.org/get'

  - description: 'HTTPS GET - not present subfield is present, assert test failure'
    request:
      path: '/get'
    response:
      statusCodes: [200]
      headers:
        patterns:
          access-control-allow-origin: '.+'
        notPresent:
          - 'not-present-header'
        notMatching:
          access-control-allow-origin: 'example.com'
        notPresentSubfields:
          Content-Type: ^application/json$
      body:
        patterns:
          - 'https://httpbin.org/get'
    shouldFail: true
  
  - description: 'HTTPS GET - not present multiple subfields'
    request:
      path: /get
    conditions:
      env:
        TEST_ENV: dev
    response:
      headers:
        notMatching: 
          Server: ^(.*(nginx|42)).*
      statusCodes:
        - 200
      body:
        patterns:
          - 'https://httpbin.org/get'

  - description: 'HTTPS GET - not present multiple subfields are present, assert test failure'
    request:
      path: /get
    conditions:
      env:
        TEST_ENV: dev
    response:
      headers:
        notMatching: 
          Server: ^(.*(gunicorn|19.9.0)).*
      statusCodes:
        - 200
      body:
        patterns:
          - 'https://httpbin.org/get'
    shouldFail: true

  - description: 'HTTP POST'
    request:
      method: 'POST'
      path: '/post'
      body: 'testvalue'
    response:
      statusCodes: [200]
      body:
        patterns:
          - 'https://httpbin.org/post'
          - 'testvalue'

  - description: 'HTTP PATCH'
    conditions:
      env:
        TEST_ENV: '^(stg|prd)$'
    request:
      method: 'PATCH' # Unsupported method
      path: '/patch'
    response:
      statusCodes: [200]
      body:
        patterns:
          - 'https://httpbin.org/patch'

  - description: 'HTTP status code - invalid request'
    request:
      path: '/status/a'
    response:
      statusCodes: [400]

  - description: 'HTTP status code - multiple'
    request:
      path: '/status/400'
    response:
      statusCodes: [200, 301, 302, 400]

  - description: 'env var substitution'
    request:
      path: '/headers'
      headers:
        x-test-0: '${TEST_ENV}'
    response:
      statusCodes: [200]
      body:
        patterns:
          - 'dev'

  - description: 'base64'
    request:
      path: '/base64/ZTRxMmplenBreXYxcTNhOQ=='
    response:
      statusCodes: [200]
      body:
        patterns:
          - 'e4q2jezpkyv1q3a9'

  # Different host and allow invalid cert
  - description: 'invalid server cert'
    skipCertVerification: true
    request:
      host: 'wrong.host.badssl.com'
      path: '/'
    response:
      statusCodes: [200]
